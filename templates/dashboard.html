{% extends "base.html" %}

{% block title %}{{ t.dashboard_title }}{% endblock %}

{% block css %}
    <link href="{{ url_for('static', filename='css/dashboard.css') }}" rel="stylesheet">
    <style>
        /* ç®€å•çš„è¿‡æ¸¡åŠ¨ç”» */
        .layout-container { display: none; opacity: 0; transition: opacity 0.3s ease; }
        .layout-container.active { display: block; opacity: 1; }
        .accordion-button:not(.collapsed) { background-color: #2c2c2c; color: #fff; }
        .accordion-button { background-color: #1e1e1e; color: #aaa; }
    </style>
{% endblock %}

{% block js_vars %}
    <script>
    // å°†åç«¯çš„æ•°æ®åˆå§‹ä¼ é€’ç»™ JS
    let ALL_BOTS = {{ bots | tojson | safe }};
    let ALL_FOLDERS = {{ folders | tojson | safe }};
    </script>
{% endblock %}

{% block content %}
    <div id="page-loader">
        <div class="spinner-border text-info mb-3" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">{{ t.loading }}</span> </div>
        <h5 class="text-light fw-bold animate-pulse">{{ t.organizing_data }}</h5>
        <small class="text-muted">{{ t.loading_layout }}</small>
    </div>
    
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4 border-bottom border-secondary pb-3">
            <div class="d-flex align-items-center">
                {% if is_admin_view %}
                    <h2 class="text-info m-0 me-3">ğŸ‘ï¸ {{ t.view_users }}: {{ user.username }}</h2>
                    <a href="/admin" class="btn btn-outline-secondary btn-sm">â† è¿”å›</a>
                {% else %}
                    <h2 class="text-light m-0 me-3">ğŸ¤– {{ t.dashboard_title }}</h2>
                    <span class="badge bg-secondary">{{ t.user }}: {{ user.username }}</span>
                {% endif %}
            </div>
            <div>
                <a href="#" id="replayModeToggle" class="btn btn-outline-warning me-2">
                    <i class="fas fa-history"></i> <span id="replayModeText">{{ t.enter_replay_mode }}</span>
                </a>
                <button class="btn btn-outline-info me-2" data-bs-toggle="modal" data-bs-target="#downloadDataModal">
                    ğŸ“¥ {{ t.download_history_data }}
                </button>
                {% if session.get('is_admin') and not is_admin_view %}
                    <a href="/admin" class="btn btn-danger me-2">ğŸ›¡ï¸ {{ t.admin_dashboard }}</a>
                {% endif %}

                {% if not is_admin_view %}
                    <a href="/settings" class="btn btn-outline-secondary me-2">âš™ï¸ {{ t.settings }}</a>
                    <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addBotModal">+ {{ t.add_bot }}</button>
                    <a href="/logout" class="btn btn-outline-danger btn-sm">{{ t.logout }}</a>
                {% endif %}
            </div>
        </div>

        <div class="d-flex justify-content-center mb-4">
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-info active" id="btn-layout-strategy" onclick="switchLayout('strategy')">
                    ğŸ“Š {{ t.layout_bot }}
                </button>
                <button type="button" class="btn btn-outline-warning" id="btn-layout-custom" onclick="switchLayout('custom')">
                    ğŸ“ {{ t.layout_custom }}
                </button>
            </div>
        </div>

        <div id="layout-strategy-container" class="layout-container active">
        </div>

        <div id="layout-custom-container" class="layout-container">
            <div class="d-flex justify-content-end mb-3">
                <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#createFolderModal">
                    + {{ t.create_folder }}
                </button>
            </div>
            <div id="custom-folders-area" class="accordion mb-4"></div>
            <h5 class="text-muted border-bottom border-secondary pb-2">{{ t.uncategorized }}</h5>
            <div id="uncategorized-area" class="row g-4"></div>
        </div>

    </div>

    {% include "partials/dashboard_modals.html" %}

{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}